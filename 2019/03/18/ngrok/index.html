<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="xNie,wydyylyc@gmail.com"><title>ngrok服务端与客户端安装 · xNie's Blog</title><meta name="description" content="ngrok为内网穿透工具,可以实现没有公网IP下进行穿透的需要,ngrok项目放在github上,使用golang编写,使用自己搭建的ngrok服务器需要重新编译项目

编译环境
golang
apt install golang

openssl
apt install openssl

git
"><meta name="keywords" content="[&quot;java&quot;,&quot;后端&quot;]"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/accimage.png" style="width:127px;"><h3 title><a href="/">xNie's Blog</a></h3><div class="description"><p>黑作坊</p></div></div></div><ul class="social-links"></ul><div class="footer"><span>主题由 </span><a href="https://www.caicai.me">CaiCai </a><span> 与 </span><a href="https://github.com/Ben02/hexo-theme-Anatole">Ben </a><span> 设计</span><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank"> 博客框架基于Hexo</a><br><a href="https://dev.tencent.com/" target="_blank"> 使用CODING持续集成</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li><li><a href="/about">关于</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/accimage.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>ngrok服务端与客户端安装</a></h3></div><div class="post-content"><blockquote>
<p>ngrok为内网穿透工具,可以实现没有公网IP下进行穿透的需要,ngrok项目放在github上,使用golang编写,使用自己搭建的ngrok服务器需要重新编译项目</p>
</blockquote>
<h3 id="编译环境"><a href="#编译环境" class="headerlink" title="编译环境"></a>编译环境</h3><ol>
<li><p>golang</p>
<p><code>apt install golang</code></p>
</li>
<li><p>openssl</p>
<p><code>apt install openssl</code></p>
</li>
<li><p>git</p>
<p><code>apt install git</code></p>
</li>
</ol>
<h3 id="clone-ngrok项目"><a href="#clone-ngrok项目" class="headerlink" title="clone ngrok项目"></a>clone ngrok项目</h3><p>将项目从github复制到本地机器中</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/app</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/inconshreveable/ngrok.git</span><br><span class="line"><span class="built_in">cd</span> nogrk</span><br></pre></td></tr></table></figure>
<h3 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> GOPATH=/usr/<span class="built_in">local</span>/app/nogrk</span><br><span class="line"><span class="built_in">export</span> NGROK_DOMAIN=<span class="string">"ngrok.abc.com"</span></span><br></pre></td></tr></table></figure>
<h3 id="生成自有的签名证书"><a href="#生成自有的签名证书" class="headerlink" title="生成自有的签名证书"></a>生成自有的签名证书</h3><h4 id="生成证书"><a href="#生成证书" class="headerlink" title="生成证书"></a>生成证书</h4><p>证书可以作保留,以后统一使用</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">openssl genrsa -out rootCA.key 2048</span><br><span class="line">openssl req -x509 -new -nodes -key rootCA.key -subj <span class="string">"/CN=<span class="variable">$NGROK_DOMAIN</span>"</span> -days 5000 -out rootCA.pem</span><br><span class="line">openssl genrsa -out device.key 2048</span><br><span class="line">openssl req -new -key device.key -subj <span class="string">"/CN=<span class="variable">$NGROK_DOMAIN</span>"</span> -out device.csr</span><br><span class="line">openssl x509 -req -<span class="keyword">in</span> device.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out device.crt -days 5000</span><br></pre></td></tr></table></figure>
<h4 id="替换项目中证书"><a href="#替换项目中证书" class="headerlink" title="替换项目中证书"></a>替换项目中证书</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cp rootCA.pem assets/client/tls/ngrokroot.crt</span><br><span class="line">cp device.crt assets/server/tls/snakeoil.crt </span><br><span class="line">cp device.key assets/server/tls/snakeoil.key</span><br></pre></td></tr></table></figure>
<h3 id="编译文件"><a href="#编译文件" class="headerlink" title="编译文件"></a>编译文件</h3><h4 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">GOOS=linux GOARCH=amd64 make release-server</span><br></pre></td></tr></table></figure>
<p>编译后会在bin文件夹下生成ngrokd可执行文件</p>
<h4 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//windows64位运行环境的客户端</span><br><span class="line">GOOS=windows GOARCH=amd64 make release-client</span><br><span class="line">//ARM嵌入式的客户端</span><br><span class="line">GOOS=linux GOARCH=arm make release-client</span><br></pre></td></tr></table></figure>
<p>编译后在bin文件下生成对应的文件夹</p>
<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><h4 id="服务端-1"><a href="#服务端-1" class="headerlink" title="服务端"></a>服务端</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bin/ngrokd -domain=<span class="string">"abc.com"</span> -httpAddr=<span class="string">":80"</span> -httpsAddr=<span class="string">":443"</span> -<span class="built_in">log</span>-level=<span class="string">"WARNING"</span></span><br></pre></td></tr></table></figure>
<p>运行时需将<code>ngrok.abc.com</code>的域名解析到代理服务器的ip下</p>
<p>注意<code>-domain</code>与上方签名不一样,此处为一级域名,便于进行其他二级域名的转发</p>
<p>运行服务端,http端口为<code>80</code>,https端口为<code>443</code>,日志级别为<code>warning</code>,默认代理地址为<code>4443</code></p>
<h4 id="客户端-1"><a href="#客户端-1" class="headerlink" title="客户端"></a>客户端</h4><p>将编译好的客户端传送好放入运行的机器,在同目录下新建一个配置文件<code>ngrok.cfg</code>,注意服务器名为ngrok服务器的域名</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">server_addr: <span class="string">"ngrok.abc.com:4443"</span></span><br><span class="line">trust_host_root_certs: <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>windows环境下,使用命令行进行操作</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ngrok -config=./ngrok.cfg -subdomain=<span class="built_in">test</span> 80</span><br></pre></td></tr></table></figure>
<p>此命令行意为,使用<code>ngrok.cfg</code>配置文件,上级域名为<code>test</code>,即内传穿透的域名为<code>test.abc.com</code>,映射端口为80(本地端口)</p>
<p>需要把<code>test.abc.com</code>使用<code>CNAME</code>的方式解析到<code>ngrok.abc.com</code>才能起效</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2019-03-18</span><i class="fa fa-tag"></i><a class="tag" href="/tags/ngrok/" title="ngrok">ngrok </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,https://blog.ixnie.cn/2019/03/18/ngrok/,xNie's Blog,ngrok服务端与客户端安装,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2019/03/18/ngrok2/" title="ngrok搭建在docker环境">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2019/02/26/Hello/" title="Caffeine本地缓存">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script type="text/javascript" src="https://tajs.qq.com/stats?sId=66377481" charset="UTF-8"></script></body></html>